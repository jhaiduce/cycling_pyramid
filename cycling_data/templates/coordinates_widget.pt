<tal:def tal:define="title title|field.title;
                     description description|field.description;
                     errormsg errormsg|field.errormsg;
                     item_template item_template|field.widget.item_template"
         i18n:domain="deform">
  
  <div class="panel panel-default" title="${description}">
    <div class="panel-heading">${title}</div>
    <div class="panel-body">

      <div tal:condition="errormsg" 
           class="clearfix alert alert-danger">
        <p i18n:translate="">
           There was a problem with this section
        </p>
        <p>${errormsg}</p>
      </div>

      <div tal:condition="description">
        ${description}
      </div>
      
      <div id="map" style="height:400px;"></div>

      ${field.start_mapping()}
      <div tal:repeat="child field.children"
           tal:replace="structure child.render_template(item_template)" >
      </div>     
      ${field.end_mapping()}

    </div>
  </div>
  
  <script>
              var map;
          function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
              center: {lat: 39.8333333, lng: -98.585522},
              zoom: 3

            });
            var elevator = new google.maps.ElevationService;

            map.addListener('click', function(e) {
                position=e.latLng
                lat=position.lat()
                lng=position.lng()
                document.getElementById('${field.children[0].oid}').value = lat
                document.getElementById('${field.children[1].oid}').value = lng
                
                elevator.getElevationForLocations(
                    {'locations':[position]},
                    function(results,status) {
                        if(status === 'OK') {
                            if(results[0]) {
                                document.getElementById('${field.children[2].oid}').value = results[0].elevation
                            }
                            else {
                                console.log('No results found');
                            }
                        }
                        console.log('Elevation service failed due to: ' + status);
                    }
                )
            });
          }
        </script>

</tal:def>
